# Тестовое задание

Требуется создать сайт по макету в фигме. 

Стек: TypeScript, React, SASS, а так же всё что вам понадобится (например MUI
или Redux).

https://www.figma.com/file/ni2cIPmG0XbAlAUenyUWGs/Untitled?node-id=0%3A1

---
## От себя:

  Привет, читатель! 

  Реализовывая данное задание, я немного изменил дизайн проекта на свой вкус 
  и поигрался с архитектурой проекта. Бизнес логику выделил в отдельный слой RowUC.ts,
  что позволит использовать ее независимо от визуального интерфейса. 
  Если говорить о том, что еще можно было бы добавить, то следующим шагом я бы выделил слой, 
  который будет работать с различными источниками данных (redux, API, localStorage и тд)
  
  Помимо описанных ниже задач я также добавил функционал удаления строки, чтобы был полный CRUD :)
  и немного изменил порядок операций над строками

  Я сделал этот репозиторий публичным, потому что считаю, что это нечестное требование
  по отношению ко времени и силам, которые я вложил в это задание.
  Если его скопируют, то думаю его сразу можно будет отличить от остальных)

  Удачного review, senior!))

---

## Описание
Используйте в своём коде эти функции, изменять функцию recalculation запрещается:
```typescript
interface NewRowData {
  title: string // Наименование работ
  unit: string // Ед. изм.
  quantity: number // Количество
  unitPrice: number // Цена за ед.
  price: number // Стоимость

  parent: number | null // id уровня, в котором находится (либо null для первого уровня)
  type: 'level' | 'row'
}

interface RowData extends NewRowData {
  id: number
}

// функция для сохранения строки
function saveRow( rowData: NewRowData, storage: RowData[] ) {
  const index = Math.max(...storage.map(( v ) => v.id), 0) + 1
  const row: RowData = { id: index, ...rowData }

  storage.push(row)
  return {
    current: row,
    changed: recalculation(row.parent, storage)
  }
}

// функция для изменения строки
function editRow( row: RowData, storage: RowData[] ) {
  const index = storage.findIndex(( v ) => v.id === row.id)
  storage.splice(index, 1, row)

  return {
    current: row,
    changed: recalculation(row.parent, storage)
  }
}

function recalculation( parentID: number | null, storage: RowData[] ) {
  const rows = [...storage]
  const changedRows: RowData[] = []

  if (parentID == null) return changedRows
  let currentParentIndex = rows.findIndex(( v ) => v.id === parentID)
  if (currentParentIndex === -1) return changedRows

  do {
    const currentParent = rows[currentParentIndex]
    const children = rows.filter(( v ) => v.parent == currentParent.id)
    const newPrice = children.reduce(( acc, v ) => acc + v.price, 0)

    if (currentParent.price !== newPrice) {
      rows[currentParentIndex].price = newPrice
      changedRows.push(rows[currentParentIndex])

      currentParentIndex = rows.findIndex(( v ) => v.id === currentParent.parent)
      continue
    }

    break
  } while (currentParentIndex !== -1)

  return changedRows
}
```

### Термины

Уровень - строка в таблице содержащая значения только в колонке стоимость (а так же имеющая `type: 'level'`).

Расчёт - строка не являющаяся уровнем, имеет `type: 'row'`.

Режим редактирования - режим в котором можно редактировать значения строк.

### Первый вход на экран

При первом входе на экран сайта должна отображаться строка первого уровня в режиме редактирования.

### Создание строки

Для создания новой строки нужно нажать на иконку уже существующей строки (как показано на втором экране макета)

**Нажать на иконку строки которая в данный момент редактируется нельзя.**

При нажатии на иконку уровня имеется возможность создать такой же уровень, уровень ниже, и расчёт.

После создания появляется пустая строка в режиме редактирования.

### Редактирование и сохранение строки

Что бы редактировать строку нужно дважды нажать на ячейку, в которой находится значение. 

После двойного клика вся строка переходит в режим редактирования.

Что бы сохранить строку требуется нажать `Enter` внутри любого поля ввода внутри строки.

### Ограничения

При редактировании уровня мы можем редактировать только столбец `Наименование работ`.

При редактировании расчёта мы не можем редактировать столбец `Стоимость`, значение в этом столбце рассчитывается по формуле `Количество * Цена за ед.`.

Каждая строка по умолчанию должна иметь `Стоимость` равную `0`, позаботьтесь об этом.

При отображении уровней скрывайте значения в столбцах: `Ед. изм.`, `Количество` и `Цена за ед.`

# FAQ

**Можно ли использовать Redux?**
Да, вы можете использовать всё что хотите.

**Нужен ли адаптив?**
По желанию.

### Резюме

От вас требуется верстка всего экрана (всё кроме строк не является интерактивным, но это нужно сверстать). Верстка таблицы и создание/редактирование/сохранение **строк и уровней**.
Так же заметьте что функции `saveRow` и `editRow` возвращают массив изменённых строк, **от вас требуется обработать его**, и внести изменения в нужные строки в том месте, где вы их храните.
